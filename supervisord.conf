[unix_http_server]
file=/var/run/supervisor.sock   ; 通信 socket 文件
chmod=0700                       ; socket 文件的权限

[supervisord]
nodaemon=true                    ; Docker 模式必须设为 true
; 【关键修改】直接写在 log 根目录，避免因挂载导致子目录丢失
logfile=/var/log/supervisord.log
pidfile=/var/run/supervisord.pid
user=root                        ; 使用 root 运行避免权限问题

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock ; 连接 socket 的地址

[program:mihomo]
command=/usr/local/bin/mihomo -d /etc/mihomo
autostart=true
autorestart=true
; 【关键修改】直接写在 log 根目录
stdout_logfile=/var/log/mihomo.log
stderr_logfile=/var/log/mihomo.log
stopsignal=TERM

[program:manager]
command=python3 /app/manager/app.py
autostart=true
autorestart=true
; 【关键修改】直接写在 log 根目录
stdout_logfile=/var/log/manager.log
stderr_logfile=/var/log/manager.log
environment=PYTHONUNBUFFERED=1 ; 让 Python print 立即输出到日志

[unix_http_server]
file=/var/run/supervisor.sock   ; (核心修复) 创建通信用的 socket 文件
chmod=0700                       ; 权限设置

[supervisord]
nodaemon=true
logfile=/var/log/supervisord.log
pidfile=/var/run/supervisord.pid
user=root                        ; 明确指定用 root 运行，防止权限问题

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock ; (核心修复) 客户端连接 socket 的地址

[program:mihomo]
command=/usr/local/bin/mihomo -d /etc/mihomo
autostart=true
autorestart=true
stdout_logfile=/var/log/mihomo.log
stderr_logfile=/var/log/mihomo.log
stopsignal=TERM

[program:manager]
command=python3 /app/manager/app.py
autostart=true
autorestart=true
stdout_logfile=/var/log/manager.log
stderr_logfile=/var/log/manager.log
environment=PYTHONUNBUFFERED=1
